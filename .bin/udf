#!/bin/bash

# For "Update Dot Files"
# Sync dotfiles to some remote repo

cd $HOME
source $HOME/.bash_colors

OS=$(uname -s)
if [ "$OS" = "Darwin" ]; then
    echo $CYAN"‚úîÔ∏é  Backing up Brewfile"$STOP
    brew bundle dump --file=~/.Brewfile --force
fi

echo $CYAN"‚úîÔ∏é  Attempting pull from Github"$STOP
yadm pull origin master --quiet

echo $CYAN"‚úîÔ∏é  Collecting any changed or deleted files"$STOP
FILES=($(yadm status -uno --porcelain | cut -c4- | sed s/\"//g))
if [[ "${#FILES[@]}" -eq 0 ]]; then
    echo $GREEN"ü§∑‚Äç‚ôÄÔ∏è Looks like nothing's changed"$STOP
    exit 1
fi

IFS=$'\n'; for FILE in ${FILES[@]}; do
    echo $GREEN"+  Adding $HOME/$FILE"$STOP
    yadm add "$HOME/$FILE"
done

echo $CYAN"‚úîÔ∏é  Committing"$STOP
yadm commit --quiet --message "Bleh."

echo $CYAN"‚úîÔ∏é  Attempting push to Github"$STOP
yadm push origin master --quiet
